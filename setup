#!/usr/bin/env bash

DIR="$(readlink -f "$(dirname "$0")")" || exit

ln -sTv ~/.config/rclone/rclone.conf $SYNC/.config/rclone.conf 2>/dev/null

# TODO fix paths
# BASE=~/.config/nixos-rice

sudo ln -sTv $DIR/nixos /etc/nixos 2>/dev/null

paths=(
  ~/.bash_profile # to prevent tmux from running ~/.profile
  ~/.bashrc
  ~/.blerc
  ~/.config/alacritty
  ~/.config/eww
  ~/.config/hypr
  ~/.config/i3status-rust
  ~/.config/mimeapps.list
  ~/.config/nnn
  ~/.config/nvim
  ~/.config/scripts
  ~/.config/vimiv
  ~/.config/waybar
  ~/.fuzzy-home-ignore
  ~/.gitconfig
  ~/.ignore # for ripgrep
  ~/.lesskey
  ~/.profile
  ~/.tmux.conf
)

printf "%s\n" "${paths[@]}" | while read -r path; do 
  path_bac="${path/~/$DIR/home}"
  if [[ ! -e "$path_bac" ]]; then
    if [[ ! -e "$path" ]]; then
      echo "$path"
      echo "No config to backup: $path"; exit 1
    else
      echo "Backing up $path to $(readlink -e "$path_bac")"
      mv "$path" "$path_bac"
    fi
  fi
  ln -sTv "$path_bac" "$path" 2>/dev/null
done
